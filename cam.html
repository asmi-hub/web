<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <!-- 安卓Chrome/Edge状态栏颜色 -->
    <meta name="theme-color" content="#1a1a2e">
    
    <!-- iOS Safari状态栏样式 -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <title>三画面监控直播系统</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        :root {
            --status-bar-height: env(safe-area-inset-top, 0px);
        }
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #e6e6e6;
            min-height: 100vh;
            overflow-x: hidden;
            /* 为状态栏预留空间 */
            padding-top: env(safe-area-inset-top, 0px);
            padding-left: env(safe-area-inset-left, 15px);
            padding-right: env(safe-area-inset-right, 15px);
            padding-bottom: env(safe-area-inset-bottom, 0px);
        }
        
        /* 状态栏填充区域 */
        .status-bar-fill {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            height: env(safe-area-inset-top, 0px);
            background: #1a1a2e;
            z-index: 9999;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            padding: 20px 10px;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        h1 {
            font-size: 2.2rem;
            margin-bottom: 8px;
            background: linear-gradient(to right, #4cc9f0, #4361ee);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .subtitle {
            font-size: 1rem;
            color: #a0a0c0;
            opacity: 0.8;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0, 0, 0, 0.3);
            padding: 12px 20px;
            border-radius: 10px;
            margin-bottom: 25px;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: #4CAF50;
            animation: pulse 2s infinite;
        }
        
        .status-dot.offline {
            background-color: #f44336;
            animation: none;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .controls {
            display: flex;
            gap: 10px;
        }
        
        .btn {
            background: rgba(67, 97, 238, 0.7);
            border: none;
            color: white;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
            transition: all 0.3s ease;
            height: 36px;
            line-height: 14px;
        }
        
        .btn:hover {
            background: rgba(67, 97, 238, 0.9);
            transform: translateY(-2px);
        }
        
        .btn i {
            font-size: 1rem;
        }
        
        .monitor-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
        
        @media (max-width: 1024px) {
            .monitor-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .monitor-item:nth-child(3) {
                grid-column: span 2;
            }
        }
        
        @media (max-width: 768px) {
            .monitor-grid {
                grid-template-columns: 1fr;
            }
            
            .monitor-item:nth-child(3) {
                grid-column: span 1;
            }
            
            .status-bar {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .controls {
                align-self: stretch;
                justify-content: space-between;
            }
            
            .btn {
                flex: 1;
                justify-content: center;
            }
            
            /* 手机端调整内边距 */
            body {
                padding-left: env(safe-area-inset-left, 10px);
                padding-right: env(safe-area-inset-right, 10px);
            }
            
            .container {
                padding: 0 5px;
            }
        }
        
        .monitor-item {
            background: rgba(30, 30, 46, 0.8);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .monitor-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
        }
        
        .monitor-header {
            background: rgba(0, 0, 0, 0.4);
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .monitor-title {
            font-weight: 600;
            font-size: 1.1rem;
            color: #4cc9f0;
        }
        
        .monitor-actions {
            display: flex;
            gap: 8px;
        }
        
        .action-btn {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: #e6e6e6;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .action-btn:hover {
            background: rgba(76, 201, 240, 0.2);
            border-color: #4cc9f0;
        }
        
        .monitor-content {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 56.25%; /* 16:9 比例 */
        }
        
        .monitor-iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
            background-color: #000;
        }
        
        .loading {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: rgba(0, 0, 0, 0.7);
            z-index: 10;
        }
        
        .spinner {
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-left-color: #4cc9f0;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin-bottom: 15px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .quality-selector {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 5;
            background: rgba(0, 0, 0, 0.7);
            border-radius: 6px;
            padding: 8px;
            display: none;
        }
        
        .quality-selector.active {
            display: block;
        }
        
        .quality-option {
            color: white;
            padding: 8px 12px;
            cursor: pointer;
            border-radius: 4px;
            transition: background 0.2s;
        }
        
        .quality-option:hover {
            background: rgba(76, 201, 240, 0.3);
        }
        
        .quality-option.active {
            background: rgba(67, 97, 238, 0.7);
        }
        
        footer {
            text-align: center;
            padding: 20px;
            color: #a0a0c0;
            font-size: 0.9rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-bottom: env(safe-area-inset-bottom, 0px);
        }
        
        .fullscreen-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            z-index: 1000;
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding-top: env(safe-area-inset-top, 0px);
            padding-bottom: env(safe-area-inset-bottom, 0px);
        }
        
        .fullscreen-overlay.active {
            display: flex;
        }
        
        .fullscreen-header {
            width: 100%;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: absolute;
            top: env(safe-area-inset-top, 0px);
            left: 0;
            background: rgba(26, 26, 46, 0.9);
        }
        
        .fullscreen-iframe {
            width: 90%;
            height: 80%;
            border: none;
        }
        
        .notification {
            position: fixed;
            bottom: calc(20px + env(safe-area-inset-bottom, 0px));
            right: calc(20px + env(safe-area-inset-right, 0px));
            left: calc(20px + env(safe-area-inset-left, 0px));
            background: rgba(67, 97, 238, 0.9);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
            z-index: 1001;
            transform: translateX(150%);
            transition: transform 0.5s ease;
        }
        
        .notification.active {
            transform: translateX(0);
        }
        
        .notification.error {
            background: rgba(244, 67, 54, 0.9);
        }
        
        /* 针对iOS Safari的特定调整 */
        @supports (-webkit-touch-callout: none) {
            body {
                /* iOS需要减去安全区域 */
                min-height: -webkit-fill-available;
            }
            
            .fullscreen-overlay {
                /* iOS全屏模式调整 */
                height: -webkit-fill-available;
            }
        }
    </style>
</head>
<body>
    <!-- 状态栏填充 -->
    <div class="status-bar-fill"></div>
    
    <div class="container">
        <header>
            <h1><i class="fas fa-video"></i> 多画面监控直播系统</h1>
            <p class="subtitle">实时监控画面 - 三路视频同时直播</p>
        </header>
        
        <div class="status-bar">
            <div class="status-indicator">
                <div class="status-dot" id="status-dot"></div>
                <span id="status-text">所有摄像头连接正常</span>
            </div>
            <div class="controls">
                <button class="btn" id="refresh-all">
                    <i class="fas fa-sync-alt"></i> 刷新画面
                </button>
                <button class="btn" id="layout-toggle">
                    <i class="fas fa-th"></i> 切换布局
                </button>
                <button class="btn" id="night-mode">
                    <i class="fas fa-moon"></i> 夜间模式
                </button>
            </div>
        </div>
        
        <div class="monitor-grid" id="monitor-grid">
            <!-- 监控画面1 -->
            <div class="monitor-item">
                <div class="monitor-header">
                    <div class="monitor-title">
                        <i class="fas fa-camera"></i> 摄像头 1 - 大客
                    </div>
                    <div class="monitor-actions">
                        <button class="action-btn fullscreen-btn" data-cam="1">
                            <i class="fas fa-expand"></i>
                        </button>
                        <button class="action-btn quality-btn" data-cam="1">
                            <i class="fas fa-cog"></i>
                        </button>
                    </div>
                </div>
                <div class="monitor-content">
                    <div class="loading" id="loading-1">
                        <div class="spinner"></div>
                        <p>正在连接摄像头 1...</p>
                    </div>
                    <div class="quality-selector" id="quality-1">
                        <div class="quality-option active" data-quality="auto">自动</div>
                        <div class="quality-option" data-quality="high">高清</div>
                        <div class="quality-option" data-quality="low">流畅</div>
                    </div>
                    <iframe 
                        class="monitor-iframe" 
                        id="stream-1"
                        src="http://rocks.osmi.cc:1084/stream.html?src=cam1"
                        allowfullscreen>
                    </iframe>
                </div>
            </div>
            
            <!-- 监控画面2 -->
            <div class="monitor-item">
                <div class="monitor-header">
                    <div class="monitor-title">
                        <i class="fas fa-camera"></i> 摄像头 2 - E栋
                    </div>
                    <div class="monitor-actions">
                        <button class="action-btn fullscreen-btn" data-cam="2">
                            <i class="fas fa-expand"></i>
                        </button>
                        <button class="action-btn quality-btn" data-cam="2">
                            <i class="fas fa-cog"></i>
                        </button>
                    </div>
                </div>
                <div class="monitor-content">
                    <div class="loading" id="loading-2">
                        <div class="spinner"></div>
                        <p>正在连接摄像头 2...</p>
                    </div>
                    <div class="quality-selector" id="quality-2">
                        <div class="quality-option active" data-quality="auto">自动</div>
                        <div class="quality-option" data-quality="high">高清</div>
                        <div class="quality-option" data-quality="low">流畅</div>
                    </div>
                    <iframe 
                        class="monitor-iframe" 
                        id="stream-2"
                        src="http://rocks.osmi.cc:1084/stream.html?src=cam2"
                        allowfullscreen>
                    </iframe>
                </div>
            </div>
            
            <!-- 监控画面3 -->
            <div class="monitor-item">
                <div class="monitor-header">
                    <div class="monitor-title">
                        <i class="fas fa-camera"></i> 摄像头 3 - 轻客
                    </div>
                    <div class="monitor-actions">
                        <button class="action-btn fullscreen-btn" data-cam="3">
                            <i class="fas fa-expand"></i>
                        </button>
                        <button class="action-btn quality-btn" data-cam="3">
                            <i class="fas fa-cog"></i>
                        </button>
                    </div>
                </div>
                <div class="monitor-content">
                    <div class="loading" id="loading-3">
                        <div class="spinner"></div>
                        <p>正在连接摄像头 3...</p>
                    </div>
                    <div class="quality-selector" id="quality-3">
                        <div class="quality-option active" data-quality="auto">自动</div>
                        <div class="quality-option" data-quality="high">高清</div>
                        <div class="quality-option" data-quality="low">流畅</div>
                    </div>
                    <iframe 
                        class="monitor-iframe" 
                        id="stream-3"
                        src="http://rocks.osmi.cc:1085/stream.html?src=cam"
                        allowfullscreen>
                    </iframe>
                </div>
            </div>
        </div>
        
        <footer>
            <p>监控系统 &copy; 2023 | 最后更新: <span id="last-update">--:--:--</span> | 状态: <span id="connection-status">监控中</span></p>
        </footer>
    </div>
    
    <!-- 全屏查看 -->
    <div class="fullscreen-overlay" id="fullscreen-overlay">
        <div class="fullscreen-header">
            <div class="monitor-title" id="fullscreen-title">摄像头全屏视图</div>
            <button class="btn" id="exit-fullscreen">
                <i class="fas fa-compress"></i> 退出全屏
            </button>
        </div>
        <iframe class="fullscreen-iframe" id="fullscreen-iframe"></iframe>
    </div>
    
    <!-- 通知 -->
    <div class="notification" id="notification">
        <i class="fas fa-info-circle"></i>
        <span id="notification-text">操作成功</span>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 获取元素
            const statusDot = document.getElementById('status-dot');
            const statusText = document.getElementById('status-text');
            const refreshBtn = document.getElementById('refresh-all');
            const layoutToggle = document.getElementById('layout-toggle');
            const nightModeBtn = document.getElementById('night-mode');
            const monitorGrid = document.getElementById('monitor-grid');
            const fullscreenOverlay = document.getElementById('fullscreen-overlay');
            const fullscreenIframe = document.getElementById('fullscreen-iframe');
            const exitFullscreenBtn = document.getElementById('exit-fullscreen');
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notification-text');
            const lastUpdateSpan = document.getElementById('last-update');
            const connectionStatusSpan = document.getElementById('connection-status');
            
            // 监控流URL
            const streamUrls = [
                "http://rocks.osmi.cc:1084/stream.html?src=cam1",
                "http://rocks.osmi.cc:1084/stream.html?src=cam2",
                "http://rocks.osmi.cc:1085/stream.html?src=cam"
            ];
            
            // 状态变量
            let isNightMode = false;
            let currentLayout = 'grid'; // grid, vertical, single
            let lastUpdateTime = new Date();
            let connectionStatus = 'online';
            
            // 初始化
            init();
            
            function init() {
                // 设置初始更新时间
                updateLastUpdateTime();
                
                // 检测设备类型
                detectDevice();
                
                // 监听iframe加载事件
                for (let i = 1; i <= 3; i++) {
                    const iframe = document.getElementById(`stream-${i}`);
                    const loading = document.getElementById(`loading-${i}`);
                    
                    iframe.addEventListener('load', function() {
                        // 模拟加载延迟
                        setTimeout(() => {
                            loading.style.display = 'none';
                            updateConnectionStatus();
                        }, 1000);
                    });
                    
                    // 模拟加载错误检测
                    setTimeout(() => {
                        // 随机模拟一个摄像头加载失败
                        if (Math.random() < 0.2) {
                            loading.innerHTML = '<div><i class="fas fa-exclamation-triangle" style="font-size: 2rem; color: #f44336; margin-bottom: 10px;"></i><p>摄像头连接失败</p><button class="btn" style="margin-top: 10px; height: 30px;" onclick="retryStream(' + i + ')">重新连接</button></div>';
                            updateConnectionStatus();
                        }
                    }, 3000);
                }
                
                // 绑定事件监听器
                refreshBtn.addEventListener('click', refreshAllStreams);
                layoutToggle.addEventListener('click', toggleLayout);
                nightModeBtn.addEventListener('click', toggleNightMode);
                exitFullscreenBtn.addEventListener('click', exitFullscreen);
                
                // 绑定监控画面按钮事件
                document.querySelectorAll('.fullscreen-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const camId = this.getAttribute('data-cam');
                        openFullscreen(camId);
                    });
                });
                
                document.querySelectorAll('.quality-btn').forEach(btn => {
                    btn.addEventListener('click', function() {
                        const camId = this.getAttribute('data-cam');
                        toggleQualitySelector(camId);
                    });
                });
                
                // 绑定质量选择器事件
                document.querySelectorAll('.quality-option').forEach(option => {
                    option.addEventListener('click', function() {
                        const parentId = this.parentElement.id;
                        const camId = parentId.split('-')[1];
                        
                        // 更新活动选项
                        this.parentElement.querySelectorAll('.quality-option').forEach(opt => {
                            opt.classList.remove('active');
                        });
                        this.classList.add('active');
                        
                        // 隐藏选择器
                        this.parentElement.classList.remove('active');
                        
                        // 显示通知
                        showNotification(`摄像头 ${camId} 画质已切换为: ${this.textContent}`);
                    });
                });
                
                // 点击其他地方关闭质量选择器
                document.addEventListener('click', function(event) {
                    if (!event.target.closest('.quality-btn') && !event.target.closest('.quality-selector')) {
                        document.querySelectorAll('.quality-selector').forEach(selector => {
                            selector.classList.remove('active');
                        });
                    }
                });
                
                // 定期更新状态
                setInterval(updateConnectionStatus, 5000);
                setInterval(updateLastUpdateTime, 60000);
            }
            
            // 设备检测
            function detectDevice() {
                const userAgent = navigator.userAgent;
                const isIOS = /iPad|iPhone|iPod/.test(userAgent) && !window.MSStream;
                const isAndroid = /Android/.test(userAgent);
                
                console.log(`设备检测: ${isIOS ? 'iOS' : isAndroid ? 'Android' : '其他'}`);
                
                // 根据设备类型调整UI
                if (isIOS) {
                    document.body.classList.add('ios-device');
                } else if (isAndroid) {
                    document.body.classList.add('android-device');
                }
            }
            
            // 刷新所有画面
            function refreshAllStreams() {
                showNotification('正在刷新所有监控画面...');
                
                for (let i = 1; i <= 3; i++) {
                    const iframe = document.getElementById(`stream-${i}`);
                    const loading = document.getElementById(`loading-${i}`);
                    
                    loading.style.display = 'flex';
                    iframe.src = iframe.src;
                    
                    // 模拟加载延迟
                    setTimeout(() => {
                        loading.style.display = 'none';
                    }, 1000);
                }
                
                // 更新状态
                lastUpdateTime = new Date();
                updateLastUpdateTime();
                updateConnectionStatus();
                
                setTimeout(() => {
                    showNotification('所有监控画面已刷新');
                }, 1500);
            }
            
            // 切换布局
            function toggleLayout() {
                if (currentLayout === 'grid') {
                    // 切换到垂直布局
                    monitorGrid.style.gridTemplateColumns = '1fr';
                    currentLayout = 'vertical';
                    layoutToggle.innerHTML = '<i class="fas fa-th-large"></i> 网格布局';
                    showNotification('已切换到垂直布局');
                } else if (currentLayout === 'vertical') {
                    // 切换到单画面布局
                    document.querySelectorAll('.monitor-item').forEach((item, index) => {
                        if (index !== 0) {
                            item.style.display = 'none';
                        }
                    });
                    monitorGrid.style.gridTemplateColumns = '1fr';
                    currentLayout = 'single';
                    layoutToggle.innerHTML = '<i class="fas fa-th"></i> 多画面布局';
                    showNotification('已切换到单画面布局');
                } else {
                    // 切换回网格布局
                    document.querySelectorAll('.monitor-item').forEach(item => {
                        item.style.display = 'block';
                    });
                    monitorGrid.style.gridTemplateColumns = window.innerWidth <= 768 ? '1fr' : 
                                                           window.innerWidth <= 1024 ? 'repeat(2, 1fr)' : 
                                                           'repeat(3, 1fr)';
                    currentLayout = 'grid';
                    layoutToggle.innerHTML = '<i class="fas fa-bars"></i> 垂直布局';
                    showNotification('已切换到网格布局');
                }
            }
            
            // 切换夜间模式
            function toggleNightMode() {
                isNightMode = !isNightMode;
                
                if (isNightMode) {
                    document.body.style.background = '#0a0a0a';
                    document.querySelector('.status-bar-fill').style.background = '#0a0a0a';
                    document.body.style.color = '#cccccc';
                    nightModeBtn.innerHTML = '<i class="fas fa-sun"></i> 日间模式';
                    // 更新meta主题颜色
                    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0a0a0a');
                    showNotification('夜间模式已开启');
                } else {
                    document.body.style.background = 'linear-gradient(135deg, #1a1a2e 0%, #16213e 100%)';
                    document.querySelector('.status-bar-fill').style.background = '#1a1a2e';
                    document.body.style.color = '#e6e6e6';
                    nightModeBtn.innerHTML = '<i class="fas fa-moon"></i> 夜间模式';
                    // 更新meta主题颜色
                    document.querySelector('meta[name="theme-color"]').setAttribute('content', '#1a1a2e');
                    showNotification('日间模式已开启');
                }
            }
            
            // 打开全屏
            function openFullscreen(camId) {
                const iframe = document.getElementById(`stream-${camId}`);
                const title = document.querySelector(`#stream-${camId}`).closest('.monitor-item').querySelector('.monitor-title').textContent;
                
                document.getElementById('fullscreen-title').textContent = title + ' - 全屏视图';
                fullscreenIframe.src = iframe.src;
                fullscreenOverlay.classList.add('active');
                
                // 锁定屏幕方向为横屏（如果支持）
                if (screen.orientation && screen.orientation.lock) {
                    screen.orientation.lock('landscape').catch(() => {
                        // 锁定失败时忽略
                    });
                }
                
                showNotification(`摄像头 ${camId} 全屏模式`);
            }
            
            // 退出全屏
            function exitFullscreen() {
                fullscreenOverlay.classList.remove('active');
                fullscreenIframe.src = '';
                
                // 解锁屏幕方向
                if (screen.orientation && screen.orientation.unlock) {
                    screen.orientation.unlock();
                }
            }
            
            // 切换质量选择器
            function toggleQualitySelector(camId) {
                const qualitySelector = document.getElementById(`quality-${camId}`);
                const isActive = qualitySelector.classList.contains('active');
                
                // 关闭其他选择器
                document.querySelectorAll('.quality-selector').forEach(selector => {
                    selector.classList.remove('active');
                });
                
                // 切换当前选择器
                if (!isActive) {
                    qualitySelector.classList.add('active');
                }
            }
            
            // 更新连接状态
            function updateConnectionStatus() {
                // 模拟状态检查
                const isOnline = Math.random() > 0.1; // 90% 在线概率
                
                if (isOnline) {
                    statusDot.className = 'status-dot';
                    statusText.textContent = '所有摄像头连接正常';
                    connectionStatus = 'online';
                    connectionStatusSpan.textContent = '在线';
                    connectionStatusSpan.style.color = '#4CAF50';
                } else {
                    statusDot.className = 'status-dot offline';
                    statusText.textContent = '部分摄像头连接异常';
                    connectionStatus = 'offline';
                    connectionStatusSpan.textContent = '部分异常';
                    connectionStatusSpan.style.color = '#f44336';
                }
            }
            
            // 更新最后更新时间
            function updateLastUpdateTime() {
                const now = new Date();
                const timeString = now.toLocaleTimeString('zh-CN', { hour12: false });
                lastUpdateSpan.textContent = timeString;
            }
            
            // 显示通知
            function showNotification(message, isError = false) {
                notificationText.textContent = message;
                
                if (isError) {
                    notification.classList.add('error');
                } else {
                    notification.classList.remove('error');
                }
                
                notification.classList.add('active');
                
                setTimeout(() => {
                    notification.classList.remove('active');
                }, 3000);
            }
            
            // 重试连接流（供错误提示按钮调用）
            window.retryStream = function(camId) {
                const iframe = document.getElementById(`stream-${camId}`);
                const loading = document.getElementById(`loading-${camId}`);
                
                loading.innerHTML = '<div class="spinner"></div><p>重新连接摄像头...</p>';
                loading.style.display = 'flex';
                
                // 模拟重新连接
                setTimeout(() => {
                    iframe.src = iframe.src;
                    
                    setTimeout(() => {
                        loading.style.display = 'none';
                        showNotification(`摄像头 ${camId} 重新连接成功`);
                        updateConnectionStatus();
                    }, 1500);
                }, 1000);
            };
            
            // 处理窗口大小变化
            window.addEventListener('resize', function() {
                if (currentLayout === 'grid') {
                    if (window.innerWidth <= 768) {
                        monitorGrid.style.gridTemplateColumns = '1fr';
                    } else if (window.innerWidth <= 1024) {
                        monitorGrid.style.gridTemplateColumns = 'repeat(2, 1fr)';
                    } else {
                        monitorGrid.style.gridTemplateColumns = 'repeat(3, 1fr)';
                    }
                }
            });
            
            // 处理设备旋转
            window.addEventListener('orientationchange', function() {
                // 给一点延迟让设备完成旋转
                setTimeout(() => {
                    console.log('屏幕方向改变:', screen.orientation.type);
                    // 可以在这里添加方向改变后的处理逻辑
                }, 300);
            });
        });
    </script>
</body>
</html>