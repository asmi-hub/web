<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ¥· å¼±æ°´ä¸‰åƒåªå–ä¸€ç“¢</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }
        
        :root {
            --primary-color: #6366f1;
            --primary-dark: #4f46e5;
            --bg-dark: #0f172a;
            --bg-card: #1e293b;
            --bg-card-light: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --border-color: #475569;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --collapse-color: #ef4444; /* æ–°å¢ï¼šæŠ˜å æŒ‰é’®é¢œè‰² */
            --secondary-color: #8b5cf6;
            --darker-bg: #020617;
            --text-muted: #64748b;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.5);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.7);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.8);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.9);
            --gradient-primary: linear-gradient(135deg, #6366f1, #8b5cf6);
            --gradient-dark: linear-gradient(135deg, #1e293b, #0f172a);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 24px;
        }
        
        body {
            background-color: var(--bg-dark);
            color: var(--text-primary);
            line-height: 1.6;
            padding: 16px;
            min-height: 100vh;
            background-image: 
                radial-gradient(circle at 20% 30%, rgba(99, 102, 241, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(79, 70, 229, 0.08) 0%, transparent 50%);
        }
        
        /* æ¬¢è¿å¼¹çª—æ ·å¼ */
        .welcome-modal {
            display: flex; /* æ”¹ä¸ºflexï¼Œé»˜è®¤æ˜¾ç¤º */
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(15, 23, 42, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        
        .welcome-modal.hidden {
            display: none; /* ä½¿ç”¨hiddenç±»æ¥éšè— */
        }
        
        .modal-content {
            background-color: var(--bg-card);
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            text-align: center;
            border: 2px solid var(--primary-color);
            animation: modalAppear 0.5s ease-out;
        }
        
        @keyframes modalAppear {
            from {
                opacity: 0;
                transform: translateY(-30px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }
        
        .modal-icon {
            font-size: 4rem;
            color: var(--primary-color);
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 2rem;
            color: var(--text-primary);
            margin-bottom: 10px;
        }
        
        .modal-subtitle {
            color: var(--text-secondary);
            font-size: 1.1rem;
            margin-bottom: 30px;
            line-height: 1.5;
        }
        
        .modal-buttons {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-top: 30px;
        }
        
        .modal-btn {
            padding: 18px 30px;
            border: none;
            border-radius: 14px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }
        
        .modal-btn.inspection {
            background-color: var(--success-color);
            color: white;
        }
        
        .modal-btn.inspection:hover {
            background-color: #0da271;
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(16, 185, 129, 0.4);
        }
        
        .modal-btn.clock {
            background-color: var(--primary-color);
            color: white;
        }
        
        .modal-btn.clock:hover {
            background-color: var(--primary-dark);
            transform: translateY(-4px);
            box-shadow: 0 10px 25px rgba(99, 102, 241, 0.4);
        }
        
        .modal-btn i {
            font-size: 1.3rem;
        }
        
        /* æ‰“å¡å¼¹çª—æ ·å¼ */
        .clock-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(15, 23, 42, 0.95);
            z-index: 1001;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        
        .clock-modal.active {
            display: flex;
        }
        
        .clock-modal-content {
            background-color: var(--bg-card);
            border-radius: 20px;
            padding: 30px;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            text-align: center;
            border: 2px solid var(--success-color);
            animation: modalAppear 0.5s ease-out;
        }
        
        .clock-modal-header {
            margin-bottom: 25px;
        }
        
        .clock-modal-title {
            font-size: 1.8rem;
            color: var(--text-primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        
        .clock-modal-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }
        
        .clock-qr-container {
            background-color: var(--bg-card-light);
            border-radius: 16px;
            padding: 20px;
            margin: 20px 0;
            display: flex;
            justify-content: center;
            align-items: center;
            border: 2px solid var(--border-color);
        }
        
        .clock-qr-placeholder {
            width: 250px;
            height: 250px;
            background-color: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
            padding: 10px;
        }
        
        .clock-qr-placeholder img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        .clock-info {
            margin: 20px 0;
            text-align: center;
        }
        
        .clock-code {
            font-family: 'Courier New', monospace;
            background-color: rgba(0, 0, 0, 0.3);
            padding: 12px;
            border-radius: 10px;
            font-size: 0.9rem;
            color: var(--text-primary);
            margin-bottom: 15px;
            border: 1px solid var(--border-color);
        }
        
        .clock-url {
            font-size: 0.8rem;
            color: var(--text-secondary);
            word-break: break-all;
            background-color: rgba(0, 0, 0, 0.2);
            padding: 10px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }
        
        .clock-modal-buttons {
            margin-top: 25px;
        }
        
        .clock-close-btn {
            padding: 14px 30px;
            background-color: var(--bg-card-light);
            border: none;
            border-radius: 12px;
            color: var(--text-primary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            font-size: 1rem;
        }
        
        .clock-close-btn:hover {
            background-color: var(--border-color);
            transform: translateY(-3px);
        }
        
        /* è½¦é—´é€‰æ‹©å¼¹çª— */
        .facility-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(15, 23, 42, 0.95);
            z-index: 1002;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(5px);
        }
        
        .facility-modal.active {
            display: flex;
        }
        
        .facility-modal-content {
            background-color: var(--bg-card);
            border-radius: 20px;
            padding: 30px;
            max-width: 900px;
            width: 95%;
            max-height: 85vh;
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
            display: flex;
            flex-direction: column;
            border: 2px solid var(--primary-color);
            animation: modalAppear 0.5s ease-out;
        }
        
        .facility-modal-header {
            margin-bottom: 25px;
            text-align: center;
            position: relative;
        }
        
        .facility-modal-title {
            font-size: 1.8rem;
            color: var(--text-primary);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        
        .facility-modal-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }
        
        .facility-close-btn {
            position: absolute;
            top: 0;
            right: 0;
            background-color: var(--bg-card-light);
            border: none;
            border-radius: 10px;
            color: var(--text-primary);
            width: 40px;
            height: 40px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }
        
        .facility-close-btn:hover {
            background-color: var(--border-color);
            transform: translateY(-3px);
        }
        
        .facility-buttons-container {
            flex: 1;
            overflow-y: auto;
            padding-right: 5px;
        }
        
        .facility-buttons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 18px;
        }
        
        .facility-btn {
            padding: 20px 15px;
            background-color: var(--bg-card-light);
            border: none;
            border-radius: 12px;
            color: var(--text-primary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 1.1rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100px;
            position: relative;
            overflow: hidden;
        }
        
        .facility-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: var(--primary-color);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        
        .facility-btn:hover {
            background-color: var(--primary-color);
            transform: translateY(-6px);
            box-shadow: 0 8px 25px rgba(99, 102, 241, 0.3);
        }
        
        .facility-btn:hover::before {
            transform: scaleX(1);
        }
        
        .facility-btn.active {
            background-color: var(--primary-color);
            color: white;
            box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4);
        }
        
        .facility-btn.active::before {
            transform: scaleX(1);
        }
        
        /* ç§»é™¤è¶…çº²è®¾æ–½ç çš„ç‰¹æ®Šæ ·å¼ */
        .facility-btn .type-tag {
            font-size: 0.8rem;
            background: rgba(255, 255, 255, 0.15);
            padding: 4px 12px;
            border-radius: 10px;
            margin-top: 10px;
            font-weight: normal;
        }
        
        /* ä¸»å†…å®¹ - äºŒç»´ç å±•ç¤ºé¡µé¢ */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0;
            display: none;
        }
        
        .container.active {
            display: block;
        }
        
        .content {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }
        
        .qr-display {
            background-color: var(--bg-card);
            border-radius: 16px;
            padding: 24px 16px;
            box-shadow: 0 8px 25px var(--shadow-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }
        
        .qr-display h2 {
            color: var(--text-primary);
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
            width: 100%;
            text-align: center;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        
        .qr-display-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 12px;
        }
        
        /* è¿”å›é€‰æ‹©æŒ‰é’® - ç‹¬ç«‹æ ·å¼ */
        .back-to-facility-container {
            position: absolute;
            top: 24px;
            left: 24px;
            z-index: 10;
        }
        
        .back-to-facility-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 10px;
            background-color: var(--bg-card-light);
            color: var(--text-primary);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            font-size: 0.95rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
            white-space: nowrap;
        }
        
        .back-to-facility-btn:hover {
            background-color: var(--primary-color);
            color: white;
            transform: translateY(-3px);
            box-shadow: 0 6px 18px rgba(99, 102, 241, 0.4);
        }
        
        .back-to-facility-btn i {
            font-size: 1rem;
        }
        
        /* äºŒç»´ç å®¹å™¨ - æ·»åŠ ç‚¹å‡»æ•ˆæœ */
        .qr-code-container {
            background-color: var(--bg-card-light);
            border-radius: 16px;
            padding: 24px;
            width: 100%;
            max-width: 320px;
            display: flex;
            flex-direction: column;
            align-items: center;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
            margin-bottom: 10px;
            margin-top: 10px;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
        }
        
        .qr-code-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.3);
        }
        
        .qr-code-container.facility-mode-active {
            border: 2px solid var(--primary-color);
            box-shadow: 0 12px 30px rgba(99, 102, 241, 0.3);
        }
        
        .qr-placeholder {
            width: 100%;
            max-width: 280px;
            height: 280px;
            background-color: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            border: 2px solid var(--border-color);
            overflow: hidden;
            position: relative;
            padding: 10px;
            transition: all 0.3s ease;
        }
        
        .qr-placeholder:hover {
            border-color: var(--primary-color);
        }
        
        .qr-placeholder img {
            width: 100%;
            height: 100%;
            object-fit: contain;
        }
        
        /* è®¾æ–½ç æ¨¡å¼æç¤º */
        .facility-mode-hint {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            background-color: var(--primary-color);
            color: white;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.4);
            z-index: 5;
            display: none;
        }
        
        .qr-code-container.facility-mode-active .facility-mode-hint {
            display: block;
        }
        
        .qr-info {
            text-align: center;
            width: 100%;
        }
        
        .qr-title {
            font-size: 1.3rem;
            color: var(--text-primary);
            margin-bottom: 12px;
            font-weight: 700;
            line-height: 1.4;
            padding: 0 10px;
        }
        
        .qr-code {
            font-family: 'Courier New', monospace;
            background-color: rgba(0, 0, 0, 0.3);
            padding: 12px;
            border-radius: 10px;
            margin: 16px 0;
            font-size: 0.9rem;
            color: var(--text-primary);
            letter-spacing: 1px;
            overflow-x: auto;
            white-space: nowrap;
            width: 100%;
            border: 1px solid var(--border-color);
        }
        
        .qr-url-container {
            margin: 16px 0;
            width: 100%;
        }
        
        .qr-url-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-align: left;
        }
        
        .qr-url {
            font-family: 'Courier New', monospace;
            background-color: rgba(0, 0, 0, 0.3);
            padding: 12px;
            border-radius: 10px;
            font-size: 0.75rem;
            color: var(--text-primary);
            word-break: break-all;
            max-height: 100px;
            overflow-y: auto;
            width: 100%;
            text-align: left;
            border: 1px solid var(--border-color);
            line-height: 1.5;
        }
        
        .instruction {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-top: 16px;
            text-align: center;
            padding: 0 10px;
        }
        
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            width: 100%;
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 20px;
            width: 100%;
            justify-content: center;
            max-width: 300px;
        }
        
        .action-btn {
            padding: 14px 24px;
            border: none;
            border-radius: 12px;
            background-color: var(--primary-color);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            max-width: 200px;
            font-size: 1rem;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .action-btn:hover {
            background-color: var(--primary-dark);
            transform: translateY(-3px);
            box-shadow: 0 6px 18px rgba(99, 102, 241, 0.4);
        }
        
        .action-btn.next {
            background-color: var(--success-color);
        }
        
        .action-btn.next:hover {
            background-color: #0da271;
        }
        
        .action-btn:disabled {
            background-color: var(--border-color);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        footer {
            margin-top: 30px;
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.85rem;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }
        
        /* ============== ä¿®æ”¹åçš„è½¦é—´äºŒç»´ç æ‰«æç³»ç»Ÿé¡µé¢æ ·å¼ ============== */
        .qr-scan-system {
            display: none;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0;
        }
        
        .qr-scan-system.active {
            display: block;
        }
        
        /* ç§»é™¤é»‘è‰²æ¨ªå¹…å¤´éƒ¨æ ·å¼ */
        .qr-scan-header {
            background: transparent;
            border-bottom: none;
            padding: 10px 0 20px 0;
            position: relative;
            top: 0;
            z-index: 10;
            margin-bottom: 24px;
        }
        
        .qr-scan-header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 16px;
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .qr-scan-title-section {
            text-align: center;
            background-color: var(--bg-card);
            border-radius: var(--radius-xl);
            padding: 24px 20px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border-color);
        }
        
        .qr-scan-main-title {
            font-size: 28px;
            font-weight: 800;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }
        
        .qr-scan-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            opacity: 0.9;
        }
        
        /* æ§åˆ¶æŒ‰é’®åŒºåŸŸ */
        .qr-scan-controls-section {
            display: flex;
            justify-content: center;
            gap: 16px;
            margin-top: 8px;
            background-color: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 16px;
            box-shadow: var(--shadow-md);
            border: 1px solid var(--border-color);
        }
        
        /* ä½¿ç”¨ç»Ÿä¸€çš„æ§åˆ¶æŒ‰é’®æ ·å¼ */
        .control-btn {
            background: var(--bg-card-light);
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            padding: 12px 24px;
            border-radius: var(--radius-lg);
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: var(--shadow-sm);
        }
        
        .control-btn:hover {
            background: var(--primary-color);
            border-color: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .control-btn:active {
            transform: translateY(0);
        }
        
        .control-btn i {
            font-size: 16px;
        }
        
        /* ä¿®æ”¹ï¼šå…¨éƒ¨æŠ˜å æŒ‰é’®é¢œè‰² */
        .control-btn.collapse-all {
            background-color: var(--collapse-color);
            border-color: var(--collapse-color);
            color: white;
        }
        
        .control-btn.collapse-all:hover {
            background-color: #dc2626;
            border-color: #dc2626;
        }
        
        .control-btn.back {
            background-color: var(--bg-card-light);
            color: var(--text-primary);
        }
        
        .control-btn.back:hover {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }
        
        /* åˆ†ç±»æŠ˜å åŒºåŸŸ */
        .qr-scan-main-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 16px;
            display: flex;
            flex-direction: column;
            gap: 16px;
            padding-bottom: 32px;
        }
        
        .category-collapse {
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            overflow: hidden;
            box-shadow: var(--shadow-lg);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--border-color);
        }
        
        .category-collapse:hover {
            box-shadow: var(--shadow-xl);
            transform: translateY(-2px);
        }
        
        /* æŠ˜å æŒ‰é’®æ ·å¼ */
        .collapse-btn {
            width: 100%;
            background: transparent;
            border: none;
            padding: 18px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        
        .collapse-btn:hover {
            background: rgba(255, 255, 255, 0.05);
        }
        
        .category-header {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        /* åˆ†ç±»å›¾æ ‡ */
        .category-icon {
            width: 40px;
            height: 40px;
            background: var(--gradient-primary);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: white;
            box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3);
        }
        
        /* åˆ†ç±»æ ‡é¢˜ */
        .category-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }
        
        .category-count {
            background: var(--bg-dark);
            color: var(--text-secondary);
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-left: 12px;
        }
        
        /* æŠ˜å æŒ‡ç¤ºå™¨ */
        .collapse-indicator {
            color: var(--text-secondary);
            font-size: 20px;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .collapse-btn.collapsed .collapse-indicator {
            transform: rotate(-90deg);
        }
        
        /* æŠ˜å å†…å®¹åŒºåŸŸ */
        .collapse-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            background: var(--bg-dark);
        }
        
        .collapse-content.expanded {
            max-height: 5000px;
            border-top: 1px solid var(--border-color);
        }
        
        /* å­åˆ†ç±»æ ·å¼ */
        .subcategory {
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .subcategory:last-child {
            border-bottom: none;
        }
        
        .subcategory-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
            padding-bottom: 12px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .subcategory-icon {
            width: 32px;
            height: 32px;
            background: var(--gradient-primary);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            color: white;
        }
        
        .subcategory-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        /* äºŒç»´ç ç½‘æ ¼ - ä½¿ç”¨index0.htmlçš„å±•ç¤ºæ•ˆæœ */
        .qr-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
        }
        
        .qr-item {
            background: var(--bg-card);
            border-radius: var(--radius-lg);
            padding: 20px;
            transition: all 0.3s ease;
            border: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 16px;
            box-shadow: var(--shadow-md);
        }
        
        .qr-item:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-xl);
            background: var(--bg-card-light);
            border-color: var(--primary-color);
        }
        
        .qr-code-container-new {
            position: relative;
            width: 160px;
            height: 160px;
            background: white;
            border-radius: var(--radius-md);
            padding: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .qr-code-img {
            width: 100%;
            height: 100%;
            border-radius: var(--radius-sm);
            object-fit: contain;
        }
        
        .qr-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: var(--radius-md);
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .qr-item:hover .qr-overlay {
            opacity: 1;
        }
        
        .qr-info-new {
            text-align: center;
            width: 100%;
        }
        
        .qr-label {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 6px;
        }
        
        .qr-desc {
            font-size: 13px;
            color: var(--text-secondary);
            line-height: 1.4;
        }
        
        /* é¡µè„š */
        .qr-scan-footer {
            background: var(--bg-dark);
            border-top: 1px solid var(--border-color);
            padding: 24px 0;
            margin-top: 48px;
        }
        
        .qr-scan-footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 16px;
            text-align: center;
            color: var(--text-secondary);
            font-size: 14px;
        }
        
        /* æç¤ºä¿¡æ¯ */
        .toast {
            position: fixed;
            bottom: 24px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--bg-card);
            color: var(--text-primary);
            padding: 16px 24px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--border-color);
            z-index: 1000;
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            max-width: 400px;
            width: 90%;
        }
        
        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }
        
        /* æ‰‹æœºä¼˜åŒ– */
        @media (max-width: 768px) {
            body {
                padding: 12px;
            }
            
            .modal-content {
                padding: 30px 20px;
            }
            
            .modal-title {
                font-size: 1.7rem;
            }
            
            .modal-btn {
                padding: 16px 20px;
                font-size: 1.1rem;
            }
            
            .clock-modal-content {
                padding: 25px 20px;
            }
            
            .clock-modal-title {
                font-size: 1.5rem;
            }
            
            .clock-qr-placeholder {
                width: 220px;
                height: 220px;
            }
            
            .facility-modal-content {
                padding: 20px 15px;
                max-width: 95%;
            }
            
            .facility-buttons-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                gap: 14px;
            }
            
            .facility-btn {
                padding: 16px 12px;
                font-size: 1rem;
                min-height: 90px;
            }
            
            .qr-display {
                padding: 24px 12px;
            }
            
            /* ç§»åŠ¨ç«¯è°ƒæ•´æŒ‰é’®ä½ç½® */
            .back-to-facility-container {
                position: relative;
                top: auto;
                left: auto;
                margin-bottom: 15px;
                width: 100%;
            }
            
            .back-to-facility-btn {
                width: 100%;
                justify-content: center;
            }
            
            .qr-code-container {
                padding: 20px 16px;
                margin-top: 10px;
            }
            
            .qr-placeholder {
                max-width: 260px;
                height: 260px;
            }
            
            .qr-title {
                font-size: 1.2rem;
            }
            
            .qr-code {
                font-size: 0.85rem;
                padding: 10px;
            }
            
            .qr-url {
                font-size: 0.7rem;
                padding: 10px;
            }
            
            .action-btn {
                padding: 12px 20px;
                font-size: 0.95rem;
            }
            
            /* äºŒç»´ç æ‰«æç³»ç»Ÿå“åº”å¼ */
            .qr-scan-header-content {
                padding: 0 12px;
            }
            
            .qr-scan-main-title {
                font-size: 24px;
            }
            
            .qr-scan-controls-section {
                flex-direction: column;
                align-items: stretch;
                padding: 12px;
            }
            
            .control-btn {
                justify-content: center;
                width: 100%;
            }
            
            .qr-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .category-header {
                gap: 12px;
            }
            
            .category-icon {
                width: 36px;
                height: 36px;
                font-size: 18px;
            }
            
            .category-title {
                font-size: 16px;
            }
            
            .collapse-btn {
                padding: 16px 18px;
            }
            
            .qr-scan-main-content {
                padding: 0 12px;
            }
        }
        
        @media (max-width: 480px) {
            .modal-content {
                padding: 25px 15px;
            }
            
            .modal-title {
                font-size: 1.5rem;
            }
            
            .modal-subtitle {
                font-size: 1rem;
            }
            
            .modal-btn {
                padding: 14px 16px;
                font-size: 1rem;
            }
            
            .clock-qr-placeholder {
                width: 200px;
                height: 200px;
            }
            
            .facility-buttons-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .facility-btn .type-tag {
                font-size: 0.75rem;
                padding: 3px 8px;
            }
            
            .qr-placeholder {
                max-width: 240px;
                height: 240px;
            }
            
            .action-buttons {
                flex-direction: column;
                align-items: center;
            }
            
            .action-btn {
                max-width: 100%;
                width: 100%;
            }
            
            /* äºŒç»´ç æ‰«æç³»ç»Ÿå“åº”å¼ */
            .qr-grid {
                grid-template-columns: 1fr;
            }
            
            .collapse-btn {
                padding: 14px 16px;
            }
            
            .subcategory {
                padding: 16px;
            }
            
            .qr-code-container-new {
                width: 140px;
                height: 140px;
            }
            
            .qr-scan-controls-section {
                flex-direction: column;
            }
            
            .qr-scan-title-section {
                padding: 20px 16px;
            }
            
            .qr-scan-main-title {
                font-size: 22px;
            }
        }
        
        /* æ»šåŠ¨æ¡æ ·å¼ */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
        
        /* äºŒç»´ç å®¹å™¨ä¼˜åŒ–ï¼Œç¡®ä¿æ— é®æŒ¡ */
        .qr-code-wrapper {
            position: relative;
            width: 100%;
            display: flex;
            justify-content: center;
        }
    </style>
</head>
<body>
    <!-- æ¬¢è¿å¼¹çª— -->
    <div class="welcome-modal" id="welcomeModal">
        <div class="modal-content">
            <div class="modal-icon">
                <i class="fas fa-shield-alt"></i>
            </div>
            <h1 class="modal-title">æ¶ˆé˜²è®¾æ–½å·¡æŸ¥ç³»ç»Ÿ</h1>
            <p class="modal-subtitle">KingLong æ¶ˆé˜²è®¾æ–½å·¡æŸ¥ç³»ç»Ÿ<br>â™¨ï¸ ä½è°ƒä½¿ç”¨</p>
            
            <div class="modal-buttons">
                <button class="modal-btn inspection" id="startInspectionBtn">
                    <i class="fas fa-search"></i> å¼€å§‹å·¡æŸ¥ä»»åŠ¡
                </button>
                <button class="modal-btn clock" id="clockInOutBtn">
                    <i class="fas fa-user-clock"></i> ä¸Šä¸‹ç­æ‰“å¡
                </button>
            </div>
        </div>
    </div>
    
    <!-- æ‰“å¡å¼¹çª— -->
    <div class="clock-modal" id="clockModal">
        <div class="clock-modal-content">
            <div class="clock-modal-header">
                <h2 class="clock-modal-title">
                    <i class="fas fa-user-clock"></i> ä¸Šä¸‹ç­æ‰“å¡
                </h2>
                <p class="clock-modal-subtitle">è¯·æ‰«æä¸‹æ–¹äºŒç»´ç è¿›è¡Œä¸Šä¸‹ç­æ‰“å¡</p>
            </div>
            
            <div class="clock-qr-container">
                <div class="clock-qr-placeholder" id="clockQrPlaceholder">
                    <div class="loading">
                        <div class="loading-spinner"></div>
                        <p>æ­£åœ¨ç”Ÿæˆæ‰“å¡äºŒç»´ç ...</p>
                    </div>
                </div>
            </div>
            
            <div class="clock-info">
                <div class="clock-code" id="clockCodeText">S0000007287810</div>
                <div class="clock-url" id="clockUrlText">https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000007287810</div>
            </div>
            
            <div class="clock-modal-buttons">
                <button class="clock-close-btn" id="closeClockModalBtn">
                    <i class="fas fa-times"></i> å…³é—­
                </button>
            </div>
        </div>
    </div>
    
    <!-- è½¦é—´é€‰æ‹©å¼¹çª— -->
    <div class="facility-modal" id="facilityModal">
        <div class="facility-modal-content">
            <div class="facility-modal-header">
                <h2 class="facility-modal-title">
                    <i class="fas fa-building"></i> è½¦é—´ä¸è®¾æ–½åˆ—è¡¨
                </h2>
                <p class="facility-modal-subtitle">ç‚¹å‡»ä»»æ„è½¦é—´æˆ–è®¾æ–½æŸ¥çœ‹äºŒç»´ç </p>
                <button class="facility-close-btn" id="facilityCloseBtn">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="facility-buttons-container">
                <div class="facility-buttons-grid" id="facilityButtonsGrid">
                    <!-- è½¦é—´è®¾æ–½æŒ‰é’®å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
    </div>
    
    <!-- ä¸»å†…å®¹ - äºŒç»´ç å±•ç¤ºé¡µé¢ -->
    <div class="container" id="mainContainer">
        <div class="content">
            <div class="qr-display">
                <!-- è¿”å›é€‰æ‹©æŒ‰é’® - ç‹¬ç«‹ä½ç½® -->
                <div class="back-to-facility-container">
                    <button class="back-to-facility-btn" id="backToFacilityBtn">
                        <i class="fas fa-arrow-left"></i> è¿”å›é€‰æ‹©
                    </button>
                </div>
                
                <h2><i class="fas fa-qrcode"></i> é—½æ”¿é€šæ¶ˆç®¡å®¶äºŒç»´ç </h2>
                
                <div class="qr-code-wrapper">
                    <div class="qr-code-container" id="qrCodeContainer">
                        <!-- è®¾æ–½ç æ¨¡å¼æç¤º -->
                        
                        <div class="qr-placeholder">
                            <div id="qr-image" class="loading">
                                <div class="loading-spinner"></div>
                                <p>åŠ è½½ä¸­...</p>
                            </div>
                        </div>
                        <div class="qr-info">
                            <div class="qr-title" id="qr-title">è¯·é€‰æ‹©è½¦é—´æˆ–è®¾æ–½</div>
                            <div class="qr-code" id="qr-code-text">B0000000000000</div>
                            <div class="qr-url-container">
                                <div class="qr-url-label">è®¿é—®é“¾æ¥ï¼š</div>
                                <div class="qr-url" id="qr-url-text">https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000000000000</div>
                            </div>
                            
                            <div class="action-buttons" id="action-buttons" style="display: none;">
                                <button class="action-btn next" id="next-btn">
                                    <i class="fas fa-arrow-right"></i> ä¸‹ä¸€ä¸ªè®¾æ–½ç 
                                </button>
                            </div>
                            
                            <p class="instruction" id="instruction">ä½¿ç”¨æ‰‹æœºæ‰«æäºŒç»´ç æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <footer>
            <p>KingLong è®¾æ–½ç  &copy; 2026</p>
        </footer>
    </div>
    
    <!-- è½¦é—´äºŒç»´ç æ‰«æç³»ç»Ÿé¡µé¢ - ä¿®æ”¹ä¸ºä½¿ç”¨index0.htmlçš„æ ·å¼ -->
    <div class="qr-scan-system" id="qrScanSystem">
        <!-- å¤´éƒ¨ -->
        <header class="qr-scan-header">
            <div class="qr-scan-header-content">
                <div class="qr-scan-title-section">
                    <h1 class="qr-scan-main-title">è½¦é—´äºŒç»´ç æ‰«æç³»ç»Ÿ</h1>
                    <p class="qr-scan-subtitle">ç‚¹å‡»åˆ†ç±»å±•å¼€æŸ¥çœ‹äºŒç»´ç </p>
                </div>
                <div class="qr-scan-controls-section">
                    <button class="control-btn collapse-all" id="collapseAllBtn">
                        <i class="fas fa-compress-alt"></i>
                        æŠ˜å æ‰€æœ‰åˆ†ç±»
                    </button>
                    <button class="control-btn back" id="backFromScanBtn">
                        <i class="fas fa-arrow-left"></i> è¿”å›
                    </button>
                </div>
            </div>
        </header>
        
        <!-- ä¸»å†…å®¹ -->
        <main class="qr-scan-main-content" id="categoryContainer">
            <!-- å†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
        </main>
        
        <!-- é¡µè„š -->
        <footer class="qr-scan-footer">
            <div class="qr-scan-footer-content">
                <p>KingLong è½¦é—´äºŒç»´ç æ‰«æç³»ç»Ÿ &copy; 2026</p>
            </div>
        </footer>
        <div class="toast" id="toast"></div>
    </div>

    <script>
        // è·å–å¼¹çª—ç›¸å…³DOMå…ƒç´ 
        const welcomeModal = document.getElementById('welcomeModal');
        const clockModal = document.getElementById('clockModal');
        const facilityModal = document.getElementById('facilityModal');
        const mainContainer = document.getElementById('mainContainer');
        const qrScanSystem = document.getElementById('qrScanSystem');
        const startInspectionBtn = document.getElementById('startInspectionBtn');
        const clockInOutBtn = document.getElementById('clockInOutBtn');
        const closeClockModalBtn = document.getElementById('closeClockModalBtn');
        const facilityCloseBtn = document.getElementById('facilityCloseBtn');
        const facilityButtonsGrid = document.getElementById('facilityButtonsGrid');
        const backToFacilityBtn = document.getElementById('backToFacilityBtn');
        const clockQrPlaceholder = document.getElementById('clockQrPlaceholder');
        const clockCodeText = document.getElementById('clockCodeText');
        const clockUrlText = document.getElementById('clockUrlText');
        
        // è·å–äºŒç»´ç å±•ç¤ºé¡µé¢DOMå…ƒç´ 
        const qrCodeContainer = document.getElementById('qrCodeContainer');
        const qrTitle = document.getElementById('qr-title');
        const qrCodeText = document.getElementById('qr-code-text');
        const qrUrlText = document.getElementById('qr-url-text');
        const qrImage = document.getElementById('qr-image');
        const actionButtons = document.getElementById('action-buttons');
        const nextBtn = document.getElementById('next-btn');
        const instruction = document.getElementById('instruction');
        
        // è½¦é—´äºŒç»´ç æ‰«æç³»ç»Ÿé¡µé¢å…ƒç´ 
        const collapseAllBtn = document.getElementById('collapseAllBtn');
        const backFromScanBtn = document.getElementById('backFromScanBtn');
        const categoryContainer = document.getElementById('categoryContainer');
        const toast = document.getElementById('toast');
        
        // æ‰“å¡QRç ä¿¡æ¯
        const CLOCK_QR_CODE = "S0000007287810";
        const CLOCK_QR_URL = "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000007287810";
        
        // åŸºç¡€QRç URL
        const BASE_QR_URL = "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=";
        
        // è½¦é—´ä¸è®¾æ–½æ•°æ®
        const facilities = [
            { name: "æ€»è£…è½¦é—´", code: "B0000006340822", type: "è½¦é—´" },
            { name: "ç„Šè£…è½¦é—´", code: "B0000006340824", type: "è½¦é—´" },
            { name: "ç”µæ³³è½¦é—´", code: "B0000006340826", type: "è½¦é—´" },
            { name: "æ¶‚è£…è½¦é—´", code: "B0000006340830", type: "è½¦é—´" },
            { name: "ç‰¹ç§æ¶‚è£…è½¦é—´", code: "B0000006340835", type: "è½¦é—´" },
            { name: "è¯•åˆ¶è½¦é—´", code: "B0000006340839", type: "è½¦é—´" },
            { name: "æ¸…æ´æ¥¼", code: "B0000006340868", type: "è®¾æ–½" },
            { name: "å……ç”µæ¡©", code: "B0000006340870", type: "è®¾æ–½" },
            { name: "è”åˆåŠ¨åŠ›ç«™æˆ¿", code: "B0000006343282", type: "è®¾æ–½" },
            { name: "æ±¡æ°´å¤„ç†ç«™", code: "B0000006343285", type: "è®¾æ–½" },
            { name: "å®¢æˆ·æœåŠ¡ä¸­å¿ƒ", code: "B0000006343279", type: "åŠå…¬æ¥¼" },
            { name: "Aæ ‹åŠå…¬æ¥¼", code: "B0000006340896", type: "åŠå…¬æ¥¼" },
            { name: "Bæ ‹åŠå…¬æ¥¼", code: "B0000006340900", type: "åŠå…¬æ¥¼" },
            { name: "Eæ ‹åŠå…¬æ¥¼", code: "B0000006341172", type: "åŠå…¬æ¥¼" }
        ];
        
        // è®¾æ–½ç æ•°æ®
        const facilityCodes = {
            "Aæ ‹åŠå…¬æ¥¼": [
                { name: "ç­ç«å™¨", code: "S0000009736239", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009736239" },
                { name: "ç–æ•£æŒ‡ç¤º", code: "S0000009735960", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009735960" },
                { name: "ç–æ•£æ¥¼æ¢¯", code: "S0000009735961", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009735961" },
                { name: "åº”æ€¥ç…§æ˜", code: "S0000009735962", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009735962" }
            ],
            "Bæ ‹åŠå…¬æ¥¼": [
                { name: "ç­ç«å™¨", code: "S0000009736238", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009736238" },
                { name: "ç–æ•£æŒ‡ç¤º", code: "S0000009735968", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009735968" },
                { name: "ç–æ•£æ¥¼æ¢¯", code: "S0000009735965", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009735965" },
                { name: "åº”æ€¥ç…§æ˜", code: "S0000009735969", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009735969" }
            ],
            "Eæ ‹åŠå…¬æ¥¼": [
                { name: "ç­ç«å™¨", code: "S0000009736236", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009736236" },
                { name: "ç–æ•£æŒ‡ç¤º", code: "S0000009736139", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009736139" },
                { name: "ç–æ•£æ¥¼æ¢¯", code: "S0000009736137", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009736137" },
                { name: "åº”æ€¥ç…§æ˜", code: "S0000009736140", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009736140" }
            ],
            "å®¢æˆ·æœåŠ¡ä¸­å¿ƒ": [
                { name: "ç­ç«å™¨", code: "S0000009736231", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009736231" },
                { name: "ç–æ•£æŒ‡ç¤º", code: "S0000009736269", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009736269" },
                { name: "ç–æ•£æ¥¼æ¢¯", code: "S0000009736194", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009736194" },
                { name: "åº”æ€¥ç…§æ˜", code: "S0000009736157", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009736157" }
            ],
            "æ€»è£…è½¦é—´": [
                { name: "ç­ç«å™¨", code: "S0000009736223", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009736223" },
                { name: "å®‰å…¨å‡ºå£", code: "S0000009735858", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009735858" },
                { name: "ç–æ•£æŒ‡ç¤º", code: "S0000009735859", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009735859" },
                { name: "é…ç”µç®±", code: "S0000009735915", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009735915" }
            ],
            "ç”µæ³³è½¦é—´": [
                { name: "ç­ç«å™¨", code: "S0000009736225", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009736225" },
                { name: "æ¶ˆç«æ “", code: "S0000009735921", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009735921" },
                { name: "ç–æ•£é€šé“", code: "S0000009735920", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009735920" },
                { name: "åº”æ€¥ç…§æ˜", code: "S0000009735918", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009735918" }
            ],
            "ç„Šè£…è½¦é—´": [
                { name: "ç­ç«å™¨", code: "S0000009736224", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009736224" },
                { name: "å®‰å…¨å‡ºå£", code: "S0000009736273", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009736273" },
                { name: "ç–æ•£é€šé“", code: "S0000009735923", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009735923" }
            ],
            "æ¶‚è£…è½¦é—´": [
                { name: "ç­ç«å™¨", code: "S0000009736226", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009736226" },
                { name: "å®‰å…¨å‡ºå£", code: "S0000009735957", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009735957" },
                { name: "å¾®å‹æ¶ˆé˜²ç«™", code: "S0000009735956", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009735956" },
                { name: "æ¶ˆé˜²æ§åˆ¶å®¤", code: "S0000009735954", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009735954" }
            ],
            "æ±¡æ°´å¤„ç†ç«™": [
                { name: "ç­ç«å™¨", code: "S0000009736227", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009736227" },
                { name: "ç–æ•£æ¥¼æ¢¯", code: "S0000009736159", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009736159" }
            ],
            "è¯•åˆ¶è½¦é—´": [
                { name: "ç­ç«å™¨", code: "S0000009736230", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009736230" },
                { name: "å®‰å…¨å‡ºå£", code: "S0000009735935", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009735935" }
            ],
            "ç‰¹ç§æ¶‚è£…è½¦é—´": [
                { name: "ç­ç«å™¨", code: "S0000009736228", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009736228" },
                { name: "ç–æ•£æŒ‡ç¤º", code: "S0000009736119", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009736119" }
            ],
            "å……ç”µæ¡©": [
                { name: "ç­ç«å™¨", code: "S0000009736152", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009736152" },
                { name: "æ¶ˆç«æ “", code: "S0000009736151", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009736151" }
            ],
            "æ¸…æ´æ¥¼": [
                { name: "ç­ç«å™¨", code: "S0000009736240", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009736240" },
                { name: "é…ç”µç®±", code: "S0000009735942", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009735942" }
            ],
            "è”åˆåŠ¨åŠ›ç«™æˆ¿": [
                { name: "ç­ç«å™¨", code: "S0000009736229", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009736229" },
                { name: "é…ç”µç®±", code: "S0000009736168", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=S0000009736168" }
            ]
        };
        
        // è½¦é—´äºŒç»´ç æ‰«æç³»ç»Ÿæ•°æ®
        const qrScanData = [
            {
                category: "ç”Ÿäº§è½¦é—´",
                icon: "fas fa-industry",
                items: [
                    {
                        subCategory: "æ€»è£…è½¦é—´",
                        subCategoryIcon: "fas fa-cogs",
                        items: [
                            { name: "æ€»è£…è½¦é—´", code: "B0000006340822", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006340822" },
                            { name: "æ€»è£…è½¦é—´-åœ°ä¸Š1å±‚", code: "B0000006340823", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006340823" }
                        ]
                    },
                    {
                        subCategory: "ç„Šè£…è½¦é—´",
                        subCategoryIcon: "fas fa-wrench",
                        items: [
                            { name: "ç„Šè£…è½¦é—´", code: "B0000006340824", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006340824" },
                            { name: "ç„Šè£…è½¦é—´-åœ°ä¸Š1å±‚", code: "B0000006340825", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006340825" }
                        ]
                    },
                    {
                        subCategory: "ç”µæ³³è½¦é—´",
                        subCategoryIcon: "fas fa-tint",
                        items: [
                            { name: "ç”µæ³³è½¦é—´", code: "B0000006340826", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006340826" },
                            { name: "ç”µæ³³è½¦é—´-åœ°ä¸Š1å±‚", code: "B0000006340827", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006340827" },
                            { name: "ç”µæ³³è½¦é—´-åœ°ä¸Š2å±‚", code: "B0000006340828", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006340828" },
                            { name: "ç”µæ³³è½¦é—´-åœ°ä¸Š3å±‚", code: "B0000006340829", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006340829" }
                        ]
                    },
                    {
                        subCategory: "æ¶‚è£…è½¦é—´",
                        subCategoryIcon: "fas fa-paint-roller",
                        items: [
                            { name: "æ¶‚è£…è½¦é—´", code: "B0000006340830", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006340830" },
                            { name: "æ¶‚è£…è½¦é—´-åœ°ä¸Š1å±‚", code: "B0000006340831", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006340831" },
                            { name: "æ¶‚è£…è½¦é—´-åœ°ä¸Š2å±‚", code: "B0000006340832", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006340832" },
                            { name: "æ¶‚è£…è½¦é—´-åœ°ä¸Š3å±‚", code: "B0000006340833", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006340833" }
                        ]
                    },
                    {
                        subCategory: "ç‰¹ç§æ¶‚è£…è½¦é—´",
                        subCategoryIcon: "fas fa-spray-can",
                        items: [
                            { name: "ç‰¹ç§æ¶‚è£…è½¦é—´", code: "B0000006340835", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006340835" },
                            { name: "ç‰¹ç§æ¶‚è£…è½¦é—´-åœ°ä¸Š1å±‚", code: "B0000006340836", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006340836" }
                        ]
                    },
                    {
                        subCategory: "è¯•åˆ¶è½¦é—´",
                        subCategoryIcon: "fas fa-flask",
                        items: [
                            { name: "è¯•åˆ¶è½¦é—´", code: "B0000006340839", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006340839" },
                            { name: "è¯•åˆ¶è½¦é—´-åœ°ä¸Š1å±‚", code: "B0000006340840", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006340840" }
                        ]
                    },
                    {
                        subCategory: "åˆ¶ä»¶è½¦é—´",
                        subCategoryIcon: "fas fa-cut",
                        items: [
                            { name: "åˆ¶ä»¶è½¦é—´", code: "B0000006340841", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006340841" },
                            { name: "åˆ¶ä»¶è½¦é—´-åœ°ä¸Š1å±‚", code: "B0000006340842", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006340842" }
                        ]
                    }
                ]
            },
            {
                category: "åŠå…¬æ¥¼",
                icon: "fas fa-building",
                items: [
                    {
                        subCategory: "Aæ ‹åŠå…¬æ¥¼",
                        subCategoryIcon: "fas fa-building",
                        items: [
                            { name: "Aæ ‹åŠå…¬æ¥¼", code: "B0000006340896", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006340896" },
                            { name: "Aæ ‹åŠå…¬æ¥¼-åœ°ä¸Š1å±‚", code: "B0000006340897", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006340897" },
                            { name: "Aæ ‹åŠå…¬æ¥¼-åœ°ä¸Š2å±‚", code: "B0000006340898", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006340898" },
                            { name: "Aæ ‹åŠå…¬æ¥¼-åœ°ä¸Š3å±‚", code: "B0000006340899", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006340899" }
                        ]
                    },
                    {
                        subCategory: "Bæ ‹åŠå…¬æ¥¼",
                        subCategoryIcon: "fas fa-building",
                        items: [
                            { name: "Bæ ‹åŠå…¬æ¥¼", code: "B0000006340900", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006340900" },
                            { name: "Bæ ‹åŠå…¬æ¥¼-åœ°ä¸Š1å±‚", code: "B0000006340901", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006340901" },
                            { name: "Bæ ‹åŠå…¬æ¥¼-åœ°ä¸Š2å±‚", code: "B0000006340902", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006340902" },
                            { name: "Bæ ‹åŠå…¬æ¥¼-åœ°ä¸Š3å±‚", code: "B0000006340903", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006340903" }
                        ]
                    },
                    {
                        subCategory: "Cæ ‹åŠå…¬æ¥¼",
                        subCategoryIcon: "fas fa-building",
                        items: [
                            { name: "Cæ ‹åŠå…¬æ¥¼", code: "B0000006341007", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006341007" },
                            { name: "Cæ ‹åŠå…¬æ¥¼-åœ°ä¸Š1å±‚", code: "B0000006341008", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006341008" },
                            { name: "Cæ ‹åŠå…¬æ¥¼-åœ°ä¸Š2å±‚", code: "B0000006341009", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006341009" }
                        ]
                    },
                    {
                        subCategory: "Eæ ‹åŠå…¬æ¥¼",
                        subCategoryIcon: "fas fa-building",
                        items: [
                            { name: "Eæ ‹åŠå…¬æ¥¼", code: "B0000006341172", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006341172" },
                            { name: "Eæ ‹åŠå…¬æ¥¼-åœ°ä¸Š1å±‚", code: "B0000006341173", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006341173" },
                            { name: "Eæ ‹åŠå…¬æ¥¼-åœ°ä¸Š2å±‚", code: "B0000006341174", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006341174" },
                            { name: "Eæ ‹åŠå…¬æ¥¼-åœ°ä¸Š3å±‚", code: "B0000006341175", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006341175" },
                            { name: "Eæ ‹åŠå…¬æ¥¼-åœ°ä¸Š4å±‚", code: "B0000006341176", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006341176" },
                            { name: "Eæ ‹åŠå…¬æ¥¼-åœ°ä¸Š5å±‚", code: "B0000006341177", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006341177" },
                            { name: "Eæ ‹åŠå…¬æ¥¼-åœ°ä¸Š6å±‚", code: "B0000006341178", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006341178" },
                            { name: "Eæ ‹åŠå…¬æ¥¼-åœ°ä¸‹1å±‚", code: "B0000006341179", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006341179" }
                        ]
                    }
                ]
            },
            {
                category: "è®¾æ–½ä¸ç«™æˆ¿",
                icon: "fas fa-tools",
                items: [
                    {
                        subCategory: "æ¸…æ´æ¥¼",
                        subCategoryIcon: "fas fa-broom",
                        items: [
                            { name: "æ¸…æ´æ¥¼", code: "B0000006340868", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006340868" },
                            { name: "æ¸…æ´æ¥¼-åœ°ä¸Š1å±‚", code: "B0000006340869", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006340869" }
                        ]
                    },
                    {
                        subCategory: "å……ç”µæ¡©",
                        subCategoryIcon: "fas fa-charging-station",
                        items: [
                            { name: "å……ç”µæ¡©", code: "B0000006340870", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006340870" },
                            { name: "å……ç”µæ¡©-åœ°ä¸Š1å±‚", code: "B0000006340871", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006340871" }
                        ]
                    },
                    {
                        subCategory: "è”åˆåŠ¨åŠ›ç«™æˆ¿",
                        subCategoryIcon: "fas fa-bolt",
                        items: [
                            { name: "è”åˆåŠ¨åŠ›ç«™æˆ¿", code: "B0000006343282", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006343282" },
                            { name: "è”åˆåŠ¨åŠ›ç«™æˆ¿-åœ°ä¸Š1å±‚", code: "B0000006343283", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006343283" }
                        ]
                    },
                    {
                        subCategory: "æ±¡æ°´å¤„ç†ç«™",
                        subCategoryIcon: "fas fa-water",
                        items: [
                            { name: "æ±¡æ°´å¤„ç†ç«™", code: "B0000006343285", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006343285" },
                            { name: "æ±¡æ°´å¤„ç†ç«™-åœ°ä¸Š1å±‚", code: "B0000006343286", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006343286" }
                        ]
                    }
                ]
            },
            {
                category: "æœåŠ¡ä¸­å¿ƒ",
                icon: "fas fa-concierge-bell",
                items: [
                    {
                        subCategory: "å®éªŒä¸­å¿ƒ",
                        subCategoryIcon: "fas fa-microscope",
                        items: [
                            { name: "å®éªŒä¸­å¿ƒ", code: "B0000006341241", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006341241" },
                            { name: "å®éªŒä¸­å¿ƒ-åœ°ä¸Š1å±‚", code: "B0000006341242", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006341242" },
                            { name: "å®éªŒä¸­å¿ƒ-åœ°ä¸Š2å±‚", code: "B0000006341311", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006341311" },
                            { name: "å®éªŒä¸­å¿ƒ-åœ°ä¸Š3å±‚", code: "B0000006341312", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006341312" }
                        ]
                    },
                    {
                        subCategory: "å®¢æˆ·æœåŠ¡ä¸­å¿ƒ",
                        subCategoryIcon: "fas fa-headset",
                        items: [
                            { name: "å®¢æˆ·æœåŠ¡ä¸­å¿ƒ", code: "B0000006343279", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006343279" },
                            { name: "å®¢æˆ·æœåŠ¡ä¸­å¿ƒ-åœ°ä¸Š1å±‚", code: "B0000006343280", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006343280" },
                            { name: "å®¢æˆ·æœåŠ¡ä¸­å¿ƒ-åœ°ä¸Š2å±‚", code: "B0000006343281", url: "https://zhxf.fj.119.gov.cn:8081/xgj/gzfw?qr=B0000006343281" }
                        ]
                    }
                ]
            }
        ];
        
        // å½“å‰çŠ¶æ€å˜é‡
        let selectedFacility = null;
        let currentFacilityCodes = [];
        let currentFacilityIndex = -1;
        let isFacilityMode = false;
        let currentBuildingName = '';
        
        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('é¡µé¢åŠ è½½å®Œæˆ');
            
            // åˆå§‹åŒ–è½¦é—´é€‰æ‹©å¼¹çª—æŒ‰é’®
            initializeFacilityButtons();
            
            // åˆå§‹åŒ–è½¦é—´äºŒç»´ç æ‰«æç³»ç»Ÿ
            initializeQRScanSystem();
            
            // ç»‘å®šäº‹ä»¶ç›‘å¬å™¨
            bindEventListeners();
        });
        
        // åˆå§‹åŒ–è½¦é—´é€‰æ‹©å¼¹çª—æŒ‰é’®
        function initializeFacilityButtons() {
            console.log('åˆå§‹åŒ–è½¦é—´æŒ‰é’®');
            
            // å…ˆæ·»åŠ åŸæœ‰çš„è½¦é—´æŒ‰é’®
            facilities.forEach(facility => {
                const button = document.createElement('button');
                button.className = 'facility-btn';
                button.dataset.code = facility.code;
                button.dataset.name = facility.name;
                button.dataset.type = facility.type;
                
                // åˆ›å»ºæŒ‰é’®å†…å®¹
                const nameSpan = document.createElement('span');
                nameSpan.textContent = facility.name;
                
                const typeSpan = document.createElement('span');
                typeSpan.className = 'type-tag';
                typeSpan.textContent = facility.type;
                
                button.appendChild(nameSpan);
                button.appendChild(typeSpan);
                
                // ç‚¹å‡»ç›´æ¥è¿›å…¥äºŒç»´ç å±•ç¤ºé¡µé¢
                button.addEventListener('click', function() {
                    console.log('ç‚¹å‡»äº†è½¦é—´æŒ‰é’®:', this.dataset.name);
                    // è®¾ç½®å½“å‰é€‰æ‹©çš„è®¾æ–½
                    selectedFacility = {
                        name: this.dataset.name,
                        code: this.dataset.code,
                        type: this.dataset.type
                    };
                    
                    // å…³é—­è½¦é—´é€‰æ‹©å¼¹çª—ï¼Œæ˜¾ç¤ºä¸»å†…å®¹ï¼ˆäºŒç»´ç å±•ç¤ºé¡µé¢ï¼‰
                    facilityModal.classList.remove('active');
                    mainContainer.classList.add('active');
                    
                    // è®¾ç½®å½“å‰é€‰æ‹©çš„è®¾æ–½
                    currentBuildingName = selectedFacility.name;
                    currentFacilityCodes = facilityCodes[currentBuildingName] || [];
                    
                    // é‡ç½®è®¾æ–½æ¨¡å¼
                    isFacilityMode = false;
                    qrCodeContainer.classList.remove('facility-mode-active');
                    actionButtons.style.display = 'none';
                    instruction.textContent = 'ğŸ‘‰ğŸ» ç‚¹å‡»å±å¹•äºŒç»´ç åˆ‡æ¢åˆ°è®¾æ–½ç ';
                    
                    // æ›´æ–°äºŒç»´ç æ˜¾ç¤º
                    updateBuildingQRDisplay(selectedFacility.name, selectedFacility.code, selectedFacility.type);
                });
                
                facilityButtonsGrid.appendChild(button);
            });
            
            // æ·»åŠ è¶…çº²è®¾æ–½ç æŒ‰é’®ï¼ˆä½¿ç”¨ä¸å…¶ä»–æŒ‰é’®ç›¸åŒçš„æ ·å¼ï¼‰
            const specialButton = document.createElement('button');
            specialButton.className = 'facility-btn';
            specialButton.id = 'superSteelFacilityBtn';
            
            // åˆ›å»ºæŒ‰é’®å†…å®¹
            const nameSpan = document.createElement('span');
            nameSpan.textContent = 'è¶…çº²è®¾æ–½ç ';
            
            const typeSpan = document.createElement('span');
            typeSpan.className = 'type-tag';
            typeSpan.textContent = 'åœ°ä¸Šä¸€å±‚';
            
            specialButton.appendChild(nameSpan);
            specialButton.appendChild(typeSpan);
            
            // ç‚¹å‡»è¿›å…¥è½¦é—´äºŒç»´ç æ‰«æç³»ç»Ÿ
            specialButton.addEventListener('click', function() {
                console.log('ç‚¹å‡»äº†è¶…çº²è®¾æ–½ç æŒ‰é’®');
                // å…³é—­è½¦é—´é€‰æ‹©å¼¹çª—ï¼Œæ˜¾ç¤ºè½¦é—´äºŒç»´ç æ‰«æç³»ç»Ÿ
                facilityModal.classList.remove('active');
                qrScanSystem.classList.add('active');
            });
            
            facilityButtonsGrid.appendChild(specialButton);
        }
        
        // åˆå§‹åŒ–è½¦é—´äºŒç»´ç æ‰«æç³»ç»Ÿ - ä½¿ç”¨æ–°çš„UIç»“æ„
        function initializeQRScanSystem() {
            console.log('åˆå§‹åŒ–è½¦é—´äºŒç»´ç æ‰«æç³»ç»Ÿ');
            
            // æ¸…ç©ºå®¹å™¨
            categoryContainer.innerHTML = '';
            
            // éå†æ•°æ®åˆ›å»ºåˆ†ç±»
            qrScanData.forEach((categoryData, categoryIndex) => {
                // åˆ›å»ºåˆ†ç±»å®¹å™¨
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category-collapse';
                
                // è®¡ç®—è¯¥åˆ†ç±»ä¸‹çš„æ€»é¡¹ç›®æ•°
                let totalItems = 0;
                categoryData.items.forEach(subCategory => {
                    totalItems += subCategory.items.length;
                });
                
                // åˆ›å»ºæŠ˜å æŒ‰é’®
                const collapseBtn = document.createElement('button');
                collapseBtn.className = 'collapse-btn collapsed';
                collapseBtn.dataset.target = `category-${categoryIndex}`;
                
                // åˆ›å»ºåˆ†ç±»å¤´éƒ¨
                const categoryHeader = document.createElement('div');
                categoryHeader.className = 'category-header';
                
                const categoryIcon = document.createElement('div');
                categoryIcon.className = 'category-icon';
                categoryIcon.innerHTML = `<i class="${categoryData.icon}"></i>`;
                
                const categoryTitleDiv = document.createElement('div');
                const categoryTitle = document.createElement('h2');
                categoryTitle.className = 'category-title';
                categoryTitle.innerHTML = `${categoryData.category} <span class="category-count">${totalItems}ä¸ªé¡¹ç›®</span>`;
                categoryTitleDiv.appendChild(categoryTitle);
                
                const collapseIndicator = document.createElement('i');
                collapseIndicator.className = 'fas fa-chevron-down collapse-indicator';
                
                categoryHeader.appendChild(categoryIcon);
                categoryHeader.appendChild(categoryTitleDiv);
                
                collapseBtn.appendChild(categoryHeader);
                collapseBtn.appendChild(collapseIndicator);
                
                // åˆ›å»ºæŠ˜å å†…å®¹åŒºåŸŸ
                const collapseContent = document.createElement('div');
                collapseContent.className = 'collapse-content';
                collapseContent.id = `category-${categoryIndex}`;
                
                // éå†å­åˆ†ç±»
                categoryData.items.forEach((subCategoryData, subCategoryIndex) => {
                    // åˆ›å»ºå­åˆ†ç±»
                    const subcategoryDiv = document.createElement('div');
                    subcategoryDiv.className = 'subcategory';
                    
                    // åˆ›å»ºå­åˆ†ç±»å¤´éƒ¨
                    const subcategoryHeader = document.createElement('div');
                    subcategoryHeader.className = 'subcategory-header';
                    
                    const subcategoryIcon = document.createElement('div');
                    subcategoryIcon.className = 'subcategory-icon';
                    subcategoryIcon.innerHTML = `<i class="${subCategoryData.subCategoryIcon}"></i>`;
                    
                    const subcategoryTitle = document.createElement('h3');
                    subcategoryTitle.className = 'subcategory-title';
                    subcategoryTitle.textContent = subCategoryData.subCategory;
                    
                    subcategoryHeader.appendChild(subcategoryIcon);
                    subcategoryHeader.appendChild(subcategoryTitle);
                    
                    // åˆ›å»ºäºŒç»´ç ç½‘æ ¼
                    const qrGrid = document.createElement('div');
                    qrGrid.className = 'qr-grid';
                    
                    // éå†é¡¹ç›®
                    subCategoryData.items.forEach((item, itemIndex) => {
                        const qrItem = document.createElement('div');
                        qrItem.className = 'qr-item';
                        
                        // äºŒç»´ç å®¹å™¨
                        const qrCodeContainerNew = document.createElement('div');
                        qrCodeContainerNew.className = 'qr-code-container-new';
                        
                        // äºŒç»´ç å›¾ç‰‡
                        const qrCodeImg = document.createElement('img');
                        qrCodeImg.className = 'qr-code-img';
                        qrCodeImg.alt = `${item.name}äºŒç»´ç `;
                        qrCodeImg.src = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(item.url)}`;
                        
                        // æ‚¬åœè¦†ç›–å±‚
                        const qrOverlay = document.createElement('div');
                        qrOverlay.className = 'qr-overlay';
                        qrOverlay.innerHTML = '<i class="fas fa-expand-alt" style="font-size: 24px; color: white;"></i>';
                        
                        qrCodeContainerNew.appendChild(qrCodeImg);
                        qrCodeContainerNew.appendChild(qrOverlay);
                        
                        // äºŒç»´ç ä¿¡æ¯
                        const qrInfoNew = document.createElement('div');
                        qrInfoNew.className = 'qr-info-new';
                        
                        const qrLabel = document.createElement('div');
                        qrLabel.className = 'qr-label';
                        qrLabel.textContent = item.name;
                        
                        const qrDesc = document.createElement('div');
                        qrDesc.className = 'qr-desc';
                        qrDesc.textContent = 'æ‰«ç è®¿é—®è¯¦ç»†ä¿¡æ¯';
                        
                        qrInfoNew.appendChild(qrLabel);
                        qrInfoNew.appendChild(qrDesc);
                        
                        // ç»„è£…é¡¹ç›®
                        qrItem.appendChild(qrCodeContainerNew);
                        qrItem.appendChild(qrInfoNew);
                        
                        // æ·»åŠ ç‚¹å‡»äº‹ä»¶ - å¤åˆ¶é“¾æ¥
                        qrItem.addEventListener('click', function(e) {
                            if (e.target.closest('.qr-code-container-new')) {
                                copyToClipboard(item.url);
                            }
                        });
                        
                        // æ·»åŠ åˆ°ç½‘æ ¼
                        qrGrid.appendChild(qrItem);
                    });
                    
                    // ç»„è£…å­åˆ†ç±»
                    subcategoryDiv.appendChild(subcategoryHeader);
                    subcategoryDiv.appendChild(qrGrid);
                    
                    // æ·»åŠ åˆ°æŠ˜å å†…å®¹
                    collapseContent.appendChild(subcategoryDiv);
                });
                
                // æ·»åŠ æŠ˜å æŒ‰é’®ç‚¹å‡»äº‹ä»¶
                collapseBtn.addEventListener('click', function() {
                    const targetContent = document.getElementById(this.dataset.target);
                    const isCollapsed = this.classList.contains('collapsed');
                    
                    if (isCollapsed) {
                        this.classList.remove('collapsed');
                        targetContent.classList.add('expanded');
                    } else {
                        this.classList.add('collapsed');
                        targetContent.classList.remove('expanded');
                    }
                    
                    // è§¦è§‰åé¦ˆ
                    if ('vibrate' in navigator) {
                        navigator.vibrate(20);
                    }
                });
                
                // ç»„è£…åˆ†ç±»
                categoryDiv.appendChild(collapseBtn);
                categoryDiv.appendChild(collapseContent);
                categoryContainer.appendChild(categoryDiv);
            });
        }
        
        // ç»‘å®šæ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨
        function bindEventListeners() {
            console.log('ç»‘å®šäº‹ä»¶ç›‘å¬å™¨');
            
            // "å¼€å§‹å·¡æŸ¥ä»»åŠ¡"æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            startInspectionBtn.addEventListener('click', function() {
                console.log('ç‚¹å‡»äº†å¼€å§‹å·¡æŸ¥ä»»åŠ¡æŒ‰é’®');
                // éšè—æ¬¢è¿å¼¹çª—ï¼Œæ˜¾ç¤ºè½¦é—´é€‰æ‹©å¼¹çª—
                welcomeModal.classList.add('hidden');
                facilityModal.classList.add('active');
            });
            
            // "ä¸Šä¸‹ç­æ‰“å¡"æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            clockInOutBtn.addEventListener('click', function() {
                console.log('ç‚¹å‡»äº†ä¸Šä¸‹ç­æ‰“å¡æŒ‰é’®');
                // éšè—æ¬¢è¿å¼¹çª—ï¼Œæ˜¾ç¤ºæ‰“å¡å¼¹çª—
                welcomeModal.classList.add('hidden');
                clockModal.classList.add('active');
                
                // ç”Ÿæˆæ‰“å¡äºŒç»´ç 
                generateClockQRCode();
            });
            
            // å…³é—­æ‰“å¡å¼¹çª—æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            closeClockModalBtn.addEventListener('click', function() {
                console.log('ç‚¹å‡»äº†å…³é—­æ‰“å¡å¼¹çª—æŒ‰é’®');
                // å…³é—­æ‰“å¡å¼¹çª—ï¼Œå›åˆ°æ¬¢è¿å¼¹çª—
                clockModal.classList.remove('active');
                welcomeModal.classList.remove('hidden');
            });
            
            // è½¦é—´é€‰æ‹©å¼¹çª—å…³é—­æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            facilityCloseBtn.addEventListener('click', function() {
                console.log('ç‚¹å‡»äº†è½¦é—´å¼¹çª—å…³é—­æŒ‰é’®');
                // å…³é—­è½¦é—´é€‰æ‹©å¼¹çª—ï¼Œå›åˆ°æ¬¢è¿å¼¹çª—
                facilityModal.classList.remove('active');
                welcomeModal.classList.remove('hidden');
            });
            
            // äºŒç»´ç å±•ç¤ºé¡µé¢è¿”å›æŒ‰é’®ç‚¹å‡»äº‹ä»¶
            backToFacilityBtn.addEventListener('click', function() {
                console.log('ç‚¹å‡»äº†è¿”å›é€‰æ‹©æŒ‰é’®');
                // éšè—ä¸»å†…å®¹ï¼Œæ˜¾ç¤ºè½¦é—´é€‰æ‹©å¼¹çª—
                mainContainer.classList.remove('active');
                facilityModal.classList.add('active');
            });
            
            // äºŒç»´ç å®¹å™¨ç‚¹å‡»äº‹ä»¶ - è¿›å…¥è®¾æ–½ç æ¨¡å¼
            qrCodeContainer.addEventListener('click', function() {
                console.log('ç‚¹å‡»äº†äºŒç»´ç å®¹å™¨');
                
                if (!currentBuildingName) {
                    alert('è¯·å…ˆé€‰æ‹©ä¸€ä¸ªè½¦é—´æˆ–è®¾æ–½');
                    return;
                }
                
                if (currentFacilityCodes.length === 0) {
                    alert('å½“å‰é€‰æ‹©çš„éƒ¨ä½æš‚æ— è®¾æ–½ç ä¿¡æ¯');
                    return;
                }
                
                showFacilityQRCode();
                
                // æ»šåŠ¨åˆ°é¡¶éƒ¨ï¼Œç¡®ä¿äºŒç»´ç å¯è§
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
            
            // ä¸‹ä¸€ä¸ªæŒ‰é’®ç‚¹å‡»äº‹ä»¶
            nextBtn.addEventListener('click', showNextFacilityCode);
            
            // è½¦é—´äºŒç»´ç æ‰«æç³»ç»Ÿäº‹ä»¶
            collapseAllBtn.addEventListener('click', function() {
                console.log('æŠ˜å æ‰€æœ‰åˆ†ç±»');
                const collapseButtons = document.querySelectorAll('.collapse-btn');
                const collapseContents = document.querySelectorAll('.collapse-content');
                
                collapseButtons.forEach(button => {
                    button.classList.add('collapsed');
                });
                
                collapseContents.forEach(content => {
                    content.classList.remove('expanded');
                });
            });
            
            backFromScanBtn.addEventListener('click', function() {
                console.log('ä»æ‰«æç³»ç»Ÿè¿”å›');
                // éšè—è½¦é—´äºŒç»´ç æ‰«æç³»ç»Ÿï¼Œæ˜¾ç¤ºè½¦é—´é€‰æ‹©å¼¹çª—
                qrScanSystem.classList.remove('active');
                facilityModal.classList.add('active');
            });
            
            // ä¸ºäºŒç»´ç æ·»åŠ é•¿æŒ‰ä¿å­˜æç¤º
            let pressTimer;
            document.addEventListener('touchstart', function(e) {
                if (e.target.closest('.qr-code-container-new')) {
                    pressTimer = setTimeout(() => {
                        showToast('é•¿æŒ‰äºŒç»´ç å¯ä¿å­˜åˆ°ç›¸å†Œ');
                    }, 800);
                }
            });
            
            document.addEventListener('touchend', function() {
                clearTimeout(pressTimer);
            });
            
            document.addEventListener('touchmove', function() {
                clearTimeout(pressTimer);
            });
        }
        
        // ç”Ÿæˆæ‰“å¡äºŒç»´ç 
        function generateClockQRCode() {
            console.log('ç”Ÿæˆæ‰“å¡äºŒç»´ç ');
            // æ›´æ–°æ–‡æœ¬ä¿¡æ¯
            clockCodeText.textContent = CLOCK_QR_CODE;
            clockUrlText.textContent = CLOCK_QR_URL;
            
            // ç”ŸæˆQRç å›¾ç‰‡
            const qrSize = 250;
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=${qrSize}x${qrSize}&data=${encodeURIComponent(CLOCK_QR_URL)}`;
            
            // åˆ›å»ºå›¾ç‰‡
            const img = new Image();
            img.alt = "ä¸Šä¸‹ç­æ‰“å¡äºŒç»´ç ";
            
            // å›¾ç‰‡åŠ è½½æˆåŠŸ
            img.onload = function() {
                clockQrPlaceholder.innerHTML = '';
                clockQrPlaceholder.appendChild(img);
                console.log('æ‰“å¡äºŒç»´ç åŠ è½½æˆåŠŸ');
            };
            
            // å›¾ç‰‡åŠ è½½å¤±è´¥
            img.onerror = function() {
                clockQrPlaceholder.innerHTML = '<p>æ— æ³•åŠ è½½äºŒç»´ç ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥</p>';
                console.log('æ‰“å¡äºŒç»´ç åŠ è½½å¤±è´¥');
            };
            
            img.src = qrUrl;
        }
        
        // æ›´æ–°å»ºç­‘ç æ˜¾ç¤º
        function updateBuildingQRDisplay(name, code, type) {
            console.log('æ›´æ–°å»ºç­‘ç æ˜¾ç¤º:', name, code);
            qrTitle.textContent = name;
            qrCodeText.textContent = code;
            
            // æ„å»ºå®Œæ•´çš„URL
            const fullUrl = BASE_QR_URL + code;
            qrUrlText.textContent = fullUrl;
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            qrImage.innerHTML = '<div class="loading-spinner"></div><p>æ­£åœ¨ç”ŸæˆäºŒç»´ç ...</p>';
            qrImage.className = 'loading';
            
            // åˆ›å»ºQRç å›¾ç‰‡
            const img = new Image();
            img.alt = `${name}äºŒç»´ç `;
            
            // è®¾ç½®å›¾ç‰‡åŠ è½½å®Œæˆçš„å›è°ƒ
            img.onload = function() {
                qrImage.innerHTML = '';
                qrImage.appendChild(img);
                
                // ç§»é™¤åŠ è½½ç±»
                qrImage.classList.remove('loading');
                console.log('å»ºç­‘ç äºŒç»´ç åŠ è½½æˆåŠŸ');
            };
            
            // è®¾ç½®å›¾ç‰‡åŠ è½½é”™è¯¯çš„å›è°ƒ
            img.onerror = function() {
                qrImage.innerHTML = '<p>æ— æ³•åŠ è½½äºŒç»´ç ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥</p>';
                qrImage.classList.remove('loading');
                console.log('å»ºç­‘ç äºŒç»´ç åŠ è½½å¤±è´¥');
            };
            
            // ä½¿ç”¨ç¬¬ä¸‰æ–¹APIç”ŸæˆQRç ï¼Œç¼–ç å®Œæ•´çš„URL
            const qrSize = 250;
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=${qrSize}x${qrSize}&data=${encodeURIComponent(fullUrl)}`;
            
            img.src = qrUrl;
        }
        
        // æ˜¾ç¤ºè®¾æ–½ç 
        function showFacilityQRCode() {
            console.log('æ˜¾ç¤ºè®¾æ–½ç ');
            if (currentFacilityCodes.length === 0) {
                alert('å½“å‰é€‰æ‹©çš„éƒ¨ä½æš‚æ— è®¾æ–½ç ä¿¡æ¯');
                return;
            }
            
            // å¦‚æœæ˜¯ç¬¬ä¸€æ¬¡è¿›å…¥è®¾æ–½æ¨¡å¼ï¼Œé‡ç½®ç´¢å¼•
            if (!isFacilityMode) {
                currentFacilityIndex = 0;
                isFacilityMode = true;
                qrCodeContainer.classList.add('facility-mode-active');
                actionButtons.style.display = 'flex';
            }
            
            // è·å–å½“å‰è®¾æ–½ç 
            const facilityCode = currentFacilityCodes[currentFacilityIndex];
            
            // æ›´æ–°æ˜¾ç¤º
            instruction.textContent = `è®¾æ–½ç  ${currentFacilityIndex + 1}/${currentFacilityCodes.length}`;
            qrTitle.textContent = `${currentBuildingName} - ${facilityCode.name}`;
            qrCodeText.textContent = facilityCode.code;
            qrUrlText.textContent = facilityCode.url;
            
            // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            qrImage.innerHTML = '<div class="loading-spinner"></div><p>æ­£åœ¨ç”ŸæˆäºŒç»´ç ...</p>';
            qrImage.className = 'loading';
            
            // åˆ›å»ºQRç å›¾ç‰‡
            const img = new Image();
            img.alt = `${facilityCode.name}äºŒç»´ç `;
            
            // è®¾ç½®å›¾ç‰‡åŠ è½½å®Œæˆçš„å›è°ƒ
            img.onload = function() {
                qrImage.innerHTML = '';
                qrImage.appendChild(img);
                
                // ç§»é™¤åŠ è½½ç±»
                qrImage.classList.remove('loading');
                console.log('è®¾æ–½ç äºŒç»´ç åŠ è½½æˆåŠŸ');
            };
            
            // è®¾ç½®å›¾ç‰‡åŠ è½½é”™è¯¯çš„å›è°ƒ
            img.onerror = function() {
                qrImage.innerHTML = '<p>æ— æ³•åŠ è½½äºŒç»´ç ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥</p>';
                qrImage.classList.remove('loading');
                console.log('è®¾æ–½ç äºŒç»´ç åŠ è½½å¤±è´¥');
            };
            
            // ä½¿ç”¨ç¬¬ä¸‰æ–¹APIç”ŸæˆQRç 
            const qrSize = 250;
            const qrUrl = `https://api.qrserver.com/v1/create-qr-code/?size=${qrSize}x${qrSize}&data=${encodeURIComponent(facilityCode.url)}`;
            
            img.src = qrUrl;
        }
        
        // æ˜¾ç¤ºä¸‹ä¸€ä¸ªè®¾æ–½ç 
        function showNextFacilityCode() {
            console.log('æ˜¾ç¤ºä¸‹ä¸€ä¸ªè®¾æ–½ç ');
            if (currentFacilityCodes.length === 0 || !isFacilityMode) {
                return;
            }
            
            // æ›´æ–°ç´¢å¼•ï¼ˆå¾ªç¯ï¼‰
            currentFacilityIndex = (currentFacilityIndex + 1) % currentFacilityCodes.length;
            
            // æ˜¾ç¤ºæ–°çš„è®¾æ–½ç 
            showFacilityQRCode();
            
            // æ»šåŠ¨åˆ°é¡¶éƒ¨ï¼Œç¡®ä¿äºŒç»´ç å¯è§
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
        
        // æ˜¾ç¤ºæç¤ºä¿¡æ¯
        function showToast(message) {
            toast.textContent = message;
            toast.classList.add('show');
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        // å¤åˆ¶åˆ°å‰ªè´´æ¿å‡½æ•°
        function copyToClipboard(text) {
            // æ£€æŸ¥æ˜¯å¦æ”¯æŒclipboard API
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(text).then(function() {
                    showToast('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                    console.log('é“¾æ¥å·²å¤åˆ¶:', text);
                }).catch(function(err) {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                    // å¤‡ç”¨æ–¹æ³•
                    fallbackCopyText(text);
                });
            } else {
                // ä½¿ç”¨å¤‡ç”¨æ–¹æ³•
                fallbackCopyText(text);
            }
        }
        
        // å¤‡ç”¨å¤åˆ¶æ–¹æ³•
        function fallbackCopyText(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            
            // é˜²æ­¢å±å¹•æ»šåŠ¨
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    showToast('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                    console.log('é“¾æ¥å·²å¤åˆ¶:', text);
                } else {
                    console.error('å¤‡ç”¨å¤åˆ¶æ–¹æ³•å¤±è´¥');
                    showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶é“¾æ¥');
                }
            } catch (err) {
                console.error('å¤‡ç”¨å¤åˆ¶æ–¹æ³•å¼‚å¸¸:', err);
                showToast('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶é“¾æ¥');
            }
            
            document.body.removeChild(textArea);
        }
    </script>
</body>
</html>